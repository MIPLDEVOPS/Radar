<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Speed Display Cluster</title>
<style>
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background: #000;
    display: flex;
    flex-direction: column;
    height: 100vh;
    width: 100vw;
    overflow: hidden;
}

header {
    display: flex;
    align-items: center;
    justify-content: center; /* center text */
    position: relative;
    padding: 10px;
    background: linear-gradient(90deg,#007bff,#00ff7f);
    color: white;
    font-size: 20px;
    font-weight: bold;
}

header img {
    position: absolute;
    left: 10px;
    height: 40px;
}

header span {
    text-align: center;
}

.container {
    flex: 1;
    display: grid;
    grid-template-columns: repeat(2,1fr);
    grid-template-rows: repeat(2,1fr);
    gap: 10px;
    padding: 10px;
}

.lane {
    border-radius: 8px;
    background: #111;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 10px;
    color: white;
}

.speed {
    font-size: 12vh;
    font-weight: 900;
    margin-bottom: 8px;
}

.overspeed {
    font-size: 3vh;
    font-weight: bold;
    color: red;
    margin-bottom: 6px;
}

.timestamp {
    font-size: 2.5vh;
    color: #ccc;
}

footer {
    padding: 6px;
    text-align: center;
    background: linear-gradient(90deg,#007bff,#00ff7f);
    color: white;
    font-size: 14px;
}
</style>
</head>
<body>

<header>
  <img src="{{ url_for('static', filename='logo.png') }}">
  <span>Metro Infarsys Speed Display Cluster</span>
</header>

<div class="container">
  <div class="lane" id="lane1">
    <div class="speed">--</div>
    <div class="overspeed" style="display:none;">Overspeed</div>
    <div class="timestamp">--</div>
  </div>
  <div class="lane" id="lane2">
    <div class="speed">--</div>
    <div class="overspeed" style="display:none;">Overspeed</div>
    <div class="timestamp">--</div>
  </div>
  <div class="lane" id="lane3">
    <div class="speed">--</div>
    <div class="overspeed" style="display:none;">Overspeed</div>
    <div class="timestamp">--</div>
  </div>
  <div class="lane" id="lane4">
    <div class="speed">--</div>
    <div class="overspeed" style="display:none;">Overspeed</div>
    <div class="timestamp">--</div>
  </div>
</div>

<footer>
  &copy; 2025 Metro Infarsys Pvt Ltd
</footer>

<script>
async function loadData() {
    try {
        const res = await fetch('/api/latest');
        const data = await res.json();
        for(let i=1; i<=4; i++) {
            const lane = document.getElementById(`lane${i}`);
            const speedEl = lane.querySelector('.speed');
            const timeEl = lane.querySelector('.timestamp');
            const overEl = lane.querySelector('.overspeed');

            let s = data[i] ? data[i].speed : 0;
            let t = data[i] ? data[i].timestamp : '--';

            if(data[i]) {
                speedEl.textContent = s;
                speedEl.style.color = s>80 ? 'red' : 'limegreen';
                overEl.style.display = s>80 ? 'block' : 'none';
            } else {
                speedEl.textContent = '--';
                speedEl.style.color = 'white';
                overEl.style.display = 'none';
            }

            timeEl.textContent = t;
        }
    } catch(err) {
        console.error('Error loading data:', err);
    }
}

// Refresh every 500ms for near real-time display
setInterval(loadData, 500);
loadData();
</script>

</body>
</html>
